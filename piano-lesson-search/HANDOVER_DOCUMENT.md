# ピアノ・リトミック教室検索サイト 引き継ぎ資料

## プロジェクト概要

ピアノ教室およびリトミック教室の情報を掲載し、エンドユーザーが検索・閲覧・問い合わせを行えるウェブサイトを構築しています。教室運営者は自身の教室情報を登録・編集し、月額課金（500円）によって情報を公開できます。

## 技術スタック

- **フロントエンド**: Next.js (^14固定), React (^19.0.0), Tailwind CSS (^3.4.17), shadcn/ui (^2.1.8)
- **バックエンド/データベース**: Supabase
- **決済**: Stripe Payment Links
- **開発ツール**: TypeScript (^5.0.0), Node.js (^20.0.0), npm (^10.0.0)
- **テスト**: Playwright

## 現在の進捗状況

- **完了したタスク**: 24/50（約48%）
- **進行中のタスク**:
  - 検索機能の強化（フィルタリング、ソート、ページネーション）
  - お知らせ管理機能の実装
  - プロフィール管理機能の実装
  - パスワード変更機能の実装
  - E2Eテスト（Playwright）の実装

## 最近の修正と実装

### 1. 検索機能の強化
- 検索フィルター機能（教室タイプ、エリアによるフィルタリング）
- 検索結果のソート機能（関連度順、新着順、名前順）
- ページネーション機能
- **注意点**: Next.js 15の仕様変更に対応するため、`searchParams`を使用する前に`await Promise.resolve(searchParams)`を追加しました

### 2. お知らせ管理機能
- 教室運営者がお知らせを投稿、編集、削除できる機能
- お知らせ一覧表示機能

### 3. プロフィール管理機能
- ユーザープロフィールの編集機能
- パスワード変更機能

### 4. TypeScriptエラーの修正
- モジュールが見つからないエラーの修正
- Supabaseのアップロード関連の型エラー（onUploadProgressの型定義）の修正
- React.FormEventの型エラーの修正
- Textareaコンポーネントの作成
- Supabaseの型定義拡張（types/supabase.d.ts）

## テスト状況

現在、Playwrightを使用したE2Eテストの実装を進めています。以下のテストファイルを作成しました：

1. **stripe-payment-registration.spec.ts**: 教室情報登録のテスト（ログイン、データ入力、エラーハンドリング）
2. **stripe-payment-subscription.spec.ts**: サブスクリプション申し込みのテスト（ログイン、Stripe決済処理、キャンセルフロー）
3. **stripe-payment-announcement.spec.ts**: お知らせ投稿のテスト（ログイン、入力検証、リスト表示）

テストの実行にはいくつか課題があり、Playwrightの設定や実装方法の改善が必要です。

## 環境変数

テスト実行時に必要な環境変数：

```
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
NODE_ENV=test
TEST_USER_EMAIL=
TEST_USER_PASSWORD=
TEST_SCHOOL_NAME=
```

## 優先度の高い課題

1. **E2Eテストの改善**: Playwrightテストの安定性向上とエラーハンドリングの強化
2. **メール認証の設定**: Supabaseを使用したメール認証の実装
3. **Stripe決済連携の実装**: 月額500円のサブスクリプション処理
4. **問い合わせメール送信機能の実装**: エンドユーザーからの問い合わせメール送信
5. **統計情報表示の実装**: 閲覧数、問い合わせ数などの統計情報表示

## 次のステップ

1. Playwrightテストの改善と安定化
2. メール認証の設定
3. Stripe決済連携の実装
4. 問い合わせメール送信機能の実装
5. 統計情報表示の実装

## タイムライン

- **フェーズ1（基本機能）**: 完了
- **フェーズ2（拡張機能）**: 進行中（〜5月20日予定）
- **フェーズ3（最適化とテスト）**: 未着手（〜5月30日予定）
- **ローンチ準備**: 未着手（〜6月5日予定）
- **本番リリース**: 6月10日予定

## 注意事項

1. **Next.jsのバージョン**: バージョン14に固定してください
2. **テスト環境**: テスト実行時は`.env.test`の環境変数が使用されます
3. **TypeScript**: 型エラーの修正作業が進行中です
4. **検索機能**: Next.js 15の仕様変更に対応するため、`searchParams`の使用には注意が必要です

## GitHub情報

- アカウント: StudioAP

## 連絡先

プロジェクトに関する質問や問題がある場合は、前任者に連絡してください。
